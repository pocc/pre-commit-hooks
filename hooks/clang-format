#!/usr/bin/env bash
# Wrapper script for clang-format
CMD="clang-format"
if [ -z "$(command -v $CMD)" ]; then
	echo -e "ERR: $CMD not found.\nMake sure to install $CMD and add it to your path."
	echo -e "For more info: https://github.com/pocc/pre-commit-hooks#prerequisites"
	exit 1
fi

# Get the file argument if one exists.
for arg in "$@"; do
	argpath="$(realpath "$arg" 2>/dev/null)"
	if test -f "$argpath"; then
		filepath="$argpath"
	fi
done

if [ -z "$filepath" ]; then
	echo "ERR: No file arg found. args =" "$@"
	exit 1
fi

# If there are differences, this script will fail (and pre-commit should show this)
if [[ " $* " == *" -i "* ]]; then
	# pre-commit will fail if there are file changes due to formatting if the user
	# enters arg `-i` (change in place).
	clang-format "$@"
else
	# Otherwise clang-format should send output to stdout, and can be compared
	diff "$filepath" <(clang-format "$@")
fi
